(function(T){var W={};var Q={};var q={};var X={};var m={};var j=[];var Y={width:600,height:400};var r={};var E=false;var D=[];var aa;var b=0;var ag=0;var an=53;var x=null;var S={};var af=[];var ai=T.fn.IntemassCanvas=function(ar){var aq=T.extend(Y,ar||{});var ap=400;var at=aq.csrfvalue;if(aq.height<15||aq.width<50){alert("canvas size too small")}else{aq.height=aq.height-13;aq.width=aq.width-50;Y=aq;S={start_x:70,start_y:Y.height-50};this.each(function(){T(this).css({"float":"left",width:Y.width})});this.each(function(){var au=T(this).attr("id");K(this,at);t(this,aq);am(this);var av="<div style='float:left;width:"+ap+"px;height:"+Y.height+"px;margin:1em auto'><h1 class='ui-widget-header'> Generated Rules:</h1>";av+="<table class='intemasscanvas-table' id='list"+au+"'>";av+="<thead></thead>";av+="<tbody></tbody></table></div>";T(this).parent().append(av);s(au,at)})}};T.fn.DestoryIntemassCanvases=function(){return this.each(function(){var ap=T(this).attr("id");delete W[ap];delete Q[ap];delete X[ap];delete m[ap];T("*",this).add([this]).each(function(){T.event.remove(this);T.removeData(this)});T(this).parent().remove()})};Raphael.st.undo=function(ap,ax){var au=this;var aw=au.getBBox();var ar;var av;var aq;if(aw&&Raphael.isPointInsideBBox(aw,ap,ax)){for(var at=0;at<j.length;at++){av=j[at].split(":")[0];aq=j[at].split(":")[1];if(O(au)==="complexcurve"){if(av===au[9].attr("text")){j.splice(at,1)}}else{if(O(au)==="curve"){if(av===au[6].attr("text")){j.splice(at,1)}}else{if(O(au)==="line"){if(av===au[3].attr("text")){j.splice(at,1)}}else{if(O(au)==="dot"){if(av===au[1].attr("text")){j.splice(at,1)}}}}}}au.forEach(function(ay){if(ay.data("what")==="text"||ay.data("what")==="dottext"){for(var az in m[aq]["drawopts"]){if(az===ay.attr("text")){delete m[aq]["drawopts"][az]}}}ay.remove();ay=null;delete ay})}return false};function O(ap){if(ap.length===5){return"line"}else{if(ap.length===8){return"curve"}else{if(ap.length===11){return"complexcurve"}else{if(ap.length===2){return"dot"}}}}}function u(aq){var ap;switch(O(aq)){case"dot":ap=aq[1].attr("text");break;case"line":ap=aq[3].attr("text");break;case"curve":ap=aq[6].attr("text");break;case"complexcurve":ap=aq[9].attr("text");break;default:ap=undefined}return ap}function t(ar,aq){var ap=T(ar).attr("id");var au='<div class="intemasscanvas-canvas">';au+='<div id="'+ap+'-tips-dialog" title="Give some tips" style="display:none;">';au+='<p id="dialogue_warning" style="font-style:italic;font-family: Georgia, serif;">Please enter some tips </p>';au+='<label for="'+ap+'-tips-input" style="font-family:Times,TimesNR;font-weight:bold;margin-right:1em;">Tips:</label><textarea id="'+ap+'-tips-input" style="width:200px;height:90px;" /></div>';au+='<div id="'+ap+'-legend-dialog" title="Give A Legend" style="display:none;">';au+='<p id="dialogue_warning" style="font-style:italic;font-family: Georgia, serif;">Please assign a unique legend before drawing </p>';au+='<label for="'+ap+'-legend-input" style="font-family:Times,TimesNR;font-weight:bold;margin-right:1em;">Legend:</label><input id="'+ap+'-legend-input" type="text" value="Legend" style="width:200px;" /></div>';au+='<div id="'+ap+'-about-dialog" title="About Us" style="display:none;">';au+='<p id="dialogue_warning" style="font-style:italic;font-family: Georgia, serif;">About Us</p>';au+='<label for="'+ap+'-legend-input" style="font-family:Times,TimesNR;font-weight:bold;margin-right:1em;">About us:</label></div>';au+='<div id="'+ap+'-removeall-dialog" title="Remove All the elements" style="display:none;">';au+='<p id="dialogue_warning" style="font-style:italic;font-family: Georgia, serif;">Are you sure?</p>';au+='<label for="'+ap+'-legend-input" style="font-family:Times,TimesNR;font-weight:bold;margin-right:1em;">You will remove all the elements in the canvas.</label></div>';au+='<div id="'+ap+'-axis-dialog" class="intemasscanvas-axis-dialog" title="Set Coordinates" style="display:none;">';au+='<label for="'+ap+'-axis-name" class= "intemasscanvas-axis-label">Name:</label><input id="'+ap+'-axis-name" type="text" class="intemasscanvas-axis-input" />';au+='<label for="'+ap+'-axis-splits" class= "intemasscanvas-axis-label">Splits:</label><input id="'+ap+'-axis-splits" type="text" value="3" class="intemasscanvas-axis-input spinner-holder" />';au+='<label for="'+ap+'-axis-unit" class= "intemasscanvas-axis-label">Units:</label><input id="'+ap+'-axis-unit" type="text" value="m" class="intemasscanvas-axis-input spinner-holder" />';au+='<label for="'+ap+'-axis-start" class= "intemasscanvas-axis-label">Start Value:</label><input id="'+ap+'-axis-start" type="text" value="0" class="intemasscanvas-axis-input spinner-holder" />';au+='<label for="'+ap+'-axis-end" class= "intemasscanvas-axis-label">End Value:</label><input id="'+ap+'-axis-end" type="text" value="10" class="intemasscanvas-axis-input spinner-holder" />';au+='<label for="'+ap+'-axis-direction" class= "intemasscanvas-axis-label">Direction:</label><select id="'+ap+'-axis-direction" class="intemasscanvas-axis-select" ><option value="0" selected="selected">Horizontal</option><option value="1">Vertical</option></select>';au+="</div>";au+='<div id="'+ap+'-rule-dialog" class="intemasscanvas-rule-dialog" title="Add Rules" style="display:none;">';au+="</div>";au+="</div>";T(au).appendTo(T(ar));T("#"+ap+"-color-widget").colorpicker({color:"#ccc",parts:"popup",showCloseButton:true,showCancelButton:false,init:function(aw,av){},select:function(av,aw){X[ap]=Raphael.getRGB(aw.formatted)},close:function(av,aw){X[ap]=Raphael.getRGB(aw.formatted);if(X[ap].error===1){X[ap]="hsb(0,0,0.8)"}}});T("#"+ap+"-axis-units").spinner({min:0,max:100,mouseWheel:false});T("#"+ap+"-axis-start").spinner({min:-99999,max:99999,mouseWheel:false,step:0.01});T("#"+ap+"-axis-end").spinner({min:-99999,max:99999,mouseWheel:false,step:0.01});var at=Raphael(T(ar).find(".intemasscanvas-canvas")[0],aq.width,aq.height-10);at.rect(0,5,aq.width-5,aq.height-15,10).attr({stroke:"#666"});X[ap]="hsb(0,0,0.8)";W[ap]=at;Q[ap]=at.set();q[ap]=[];m[ap]=m[ap]||{drawopts:{},axis:{},rulelist:{}}}function K(az,aw){var aF=T(az).attr("id");var av='<span class="ui-widget-header ui-corner-all intemasscanvas-toolbar" style="float:left;">';av+='<input type="checkbox" class="lineBtn" id="'+aF+'-lineBtn"/><label for="'+aF+'-lineBtn" style="width:40px;height:40px">Add Line</label>';av+='<input type="checkbox" class="curveBtn" id="'+aF+'-curveBtn"/><label for="'+aF+'-curveBtn" style="width:40px;height:40px">Add Simple Curve</label>';av+='<input type="checkbox" class="complexcurveBtn" id="'+aF+'-complexcurveBtn"/><label for="'+aF+'-complexcurveBtn" style="width:40px;height:40px">Add Complex Curve</label>';av+='<input type="checkbox" class="dotBtn" id="'+aF+'-dotBtn"/><label for="'+aF+'-dotBtn" style="width:40px;height:40px">Add Dot</label>';av+='<input type="checkbox" class="tipsBtn" id="'+aF+'-tipsBtn"/><label for="'+aF+'-tipsBtn" style="width:40px;height:40px">Add Tips</label>';av+='<button class="axisBtn" id="'+aF+'-axisBtn" style="width:42px;height:42px;padding-bottom:13px">Set Coordinates</button>';av+='<input type="checkbox" class="moveBtn" id="'+aF+'-moveBtn" /><label for="'+aF+'-moveBtn" style="width:40px;height:40px">Move</label>';av+='<input type="checkbox" class="viewBtn" id="'+aF+'-viewBtn"/><label for="'+aF+'-viewBtn" style="width:40px;height:40px">Preview All</label>';av+='<button class="colorBtn" id="'+aF+'-colorBtn" style="width:42px;height:42px;padding-bottom:13px">Choose Color</button>';av+='<input id="'+aF+'-color-widget" style="display: none; vertical-align: bottom;"></input>';av+='<input type="checkbox" class="ruleBtn" id="'+aF+'-ruleBtn"/><label for="'+aF+'-ruleBtn" style="width:40px;height:40px">Add Rule</label>';av+='<button class="removeallBtn" id="'+aF+'-removeallBtn" style="width:42px;height:42px;padding-bottom:13px">Remove All</button>';av+='<button class="uploadBtn" id="'+aF+'-uploadBtn" style="width:42px;height:42px;padding-bottom:13px">Upload All</button>';av+="</span>";T(av).appendTo(T(az));var at=T("#"+aF+"-curveBtn").data("whatBtn","curveBtn").button({text:false,icons:{primary:"ui-icon-carat-1-ne"}});var ay=T("#"+aF+"-complexcurveBtn").data("whatBtn","complexcurveBtn").button({text:false,icons:{primary:"ui-icon-shuffle"}});var aA=T("#"+aF+"-lineBtn").data("whatBtn","lineBtn").button({text:false,icons:{primary:"ui-icon-minus"}});var aI=T("#"+aF+"-dotBtn").data("whatBtn","dotBtn").button({text:false,icons:{primary:"ui-icon-bullet"}});var aH=T("#"+aF+"-tipsBtn").data("whatBtn","tipsBtn").button({text:false,icons:{primary:"ui-icon ui-icon-document-b"}});var aE=T("#"+aF+"-axisBtn").data("whatBtn","axisBtn");var ar=T("#"+aF+"-moveBtn").data("whatBtn","moveBtn");var aC=T("#"+aF+"-colorBtn").data("whatBtn","colorBtn");var ax=T("#"+aF+"-ruleBtn").data("whatBtn","ruleBtn");var aJ=T("#"+aF+"-viewBtn").data("whatBtn","viewBtn");var aD=T("#"+aF+"-uploadBtn").data("whatBtn","uploadBtn");var aq=T("#"+aF+"-removeallBtn").data("whatBtn","removeallBtn");var ap=[at,ay,aA,aE,ar,aC,ax,aJ,aq,aI,aH];ay.add(at).add(aI).add(aA).add(aH).click(function(){var aL=T(this).data("whatBtn");var aK=T(az).find(".intemasscanvas-canvas")[0];x=T(this);if(T(this).prop("checked")){T(aK).unbind("click");aB(ap,x);au();T(aK).css("cursor","pointer");T(aK).bind("click",function(aO){var aQ=aO.pageX-this.offsetLeft;var aN=aO.pageY-this.offsetTop-an;var aM=aQ<(Y.width-200)?(aQ+200):Y.width;var aS=aN<(Y.height-200)?aN+200:Y.height;var aR={start_x:aQ,start_y:aN,end_x:aM,end_y:aS,custom_path:null,custom_handler_path:null,dashline:false,color:null};var aP=T(az).attr("id");switch(aL){case"curveBtn":v(aP,i,aR);break;case"lineBtn":v(aP,U,aR);break;case"complexcurveBtn":aR.end_y=aN;v(aP,J,aR);break;case"dotBtn":aR.end_x=null;aR.end_y=null;v(aP,f,aR);break;case"tipsBtn":aR.end_x=null;aR.end_y=null;v(aP,o,aR);break;default:break}T(aK).unbind("click");T(aK).css("cursor","auto")})}else{x=null;T(aK).unbind("click");T(aK).css("cursor","auto")}});aD.button({text:false,icons:{primary:"ui-icon-arrowthickstop-1-n"}}).click(function(){Z(aw)});aE.button({text:false,icons:{primary:"ui-icon-newwin"}}).click(function(){aB(ap,T(this));var aM="#"+aF+"-axis-dialog";var aK={};var aL={modal:true,buttons:{Done:function(){aK.name=T("#"+aF+"-axis-name").val();aK.unit=T("#"+aF+"-axis-unit").val();aK.splits=T("#"+aF+"-axis-splits").val();aK.start=T("#"+aF+"-axis-start").val();aK.end=T("#"+aF+"-axis-end").val();aK.direction=T("#"+aF+"-axis-direction").val();al(aF,aK);T(aM).dialog("close")},Cancel:function(){T(aM).dialog("close")}},width:350,draggable:false,resizable:false};T(aM).dialog(aL)});ar.button({text:false,icons:{primary:"ui-icon-arrow-4"}}).click(function(){var aL=T(az).find(".intemasscanvas-canvas")[0];var aM=Q[T(az).attr("id")];var aK=T(az).attr("id");if(T(this).prop("checked")){aB(ap,T(this));T(aL).disableContextMenu();T(aL).css("cursor","pointer");T(aL).unbind("click");aM.forEach(function(aN){aN.forEach(function(aO){if(aO.data("what")=="area"){aO.show()}})})}else{T(aL).enableContextMenu();aM.forEach(function(aN){aN.forEach(function(aO){if(aO.data("what")=="area"){aO.hide()}})});T(aL).css("cursor","auto")}});aJ.button({text:false,icons:{primary:"ui-icon-search"}}).click(function(){var aK=T(az).find(".intemasscanvas-canvas")[0];var aL=Q[T(az).attr("id")];if(T(this).prop("checked")){aB(ap,T(this));T(aK).unbind("click");T(aK).css("cursor","auto");aL.forEach(function(aM){aM.forEach(function(aN){if(aN.data("what")==="circle"||aN.data("what")==="handler_path"){aN.attr({"fill-opacity":0,"stroke-opacity":0})}if(aN.data("what")==="text"){aN.show()}})})}else{ar.click().attr("checked",false);ar.next().removeClass("ui-state-active");aL.forEach(function(aM){aM.forEach(function(aN){if(aN.data("what")=="text"){aN.hide()}else{if(aN.data("what")!=="area"){aN.attr({"fill-opacity":1,"stroke-opacity":1})}}})})}});aC.button({text:false,icons:{primary:"ui-icon-calculator"}}).click(function(){T("#"+aF+"-color-widget").focus();aB(ap,T(this))});ax.button({text:false,icons:{primary:"ui-icon-comment"}}).click(function(){aB(ap,T(this));var aK=T(az).find(".intemasscanvas-canvas")[0];if(T(this).prop("checked")){mousedownSelectionFunc=function(aM){var aL=aM.pageX-this.offsetLeft;var aN=aM.pageY-this.offsetTop-an;E=true;D.push(aL);D.push(aN)};mousemoveSelectionFunc=function(aN,aM){if(E===true){b+=1;if(b%3!=0){return}var aL=aN.pageX-this.offsetLeft;var aO=aN.pageY-this.offsetTop-an;D.push(aL);D.push(aO);H(az,D[0],D[1],D[2],D[3]);D.pop();D.pop()}};mouseupSelectionFunc=function(aS){var aQ=aS.pageX-this.offsetLeft;var aP=aS.pageY-this.offsetTop-an;var aM=T(az).attr("id");T(aK).unbind("mousedown",mousedownSelectionFunc);T(aK).unbind("mousemove",mousemoveSelectionFunc);T(aK).unbind("mouseup",mouseupSelectionFunc);if(aa){var aR="#"+aF+"-rule-dialog";var aT=[];var aO=[];aa.remove();aa=undefined;aT=ah(aM,D[0],D[1],aQ,aP);T(aR).empty();for(var aN=0;aN<aT.length;aN++){T(aR).append("<p><label>"+aT[aN]+"</label><input type='checkbox' name='"+aT[aN]+"'></input></p>")}var aL={modal:true,buttons:{SelectAll:function(){for(var aU=0;aU<T(aR).find("input").length;aU++){input=T(aR).find("input")[aU];T(input).attr("checked",true)}},Done:function(){var aU,aW;T("#"+aF+"-ruleBtn").prop("checked",false);T("#"+aF+"-ruleBtn").button("refresh");for(var aV=0;aV<T(aR).find("input").length;aV++){aU=T(aR).find("input")[aV];if(T(aU).prop("checked")){aO.push(T(aU).attr("name").split(/\s,/))}}w(aF,aO);T(aR).dialog("close")},Cancel:function(){T(aK).bind("mousedown",mousedownSelectionFunc);T(aK).bind("mousemove",mousemoveSelectionFunc);T(aK).bind("mouseup",mouseupSelectionFunc);T(aR).dialog("close")}},width:600,draggable:false,resizable:false};T(aR).dialog(aL)}E=false;D=[]};T(aK).bind("mousedown",mousedownSelectionFunc);T(aK).bind("mousemove",mousemoveSelectionFunc);T(aK).bind("mouseup",mouseupSelectionFunc)}else{T(aK).unbind("mousedown",mousedownSelectionFunc);T(aK).unbind("mousemove",mousemoveSelectionFunc);T(aK).unbind("mouseup",mouseupSelectionFunc)}});aq.button({text:false,icons:{primary:"ui-icon-trash"}}).click(function(){aB(ap,T(this));var aK=T(az).attr("id");var aL=Q[aK];var aN="#"+aK+"-removeall-dialog";var aM={modal:true,buttons:{OK:function(){aL.forEach(function(aR){aR.remove();aR=null;delete aR});for(var aP=0;aP<j.length;aP+=1){var aO=j[aP].split(":")[1];if(aO===aK){j.splice(aP,1)}}var aQ=q[aK];aQ.forEach(function(aR){aR.remove();aR=null;delete aR});T("#list"+aK+" thead tr").remove();T("#list"+aK+" tbody tr").remove();m[aK]={drawopts:{},axis:{},rulelist:{}};T(aN).dialog("close")},Cancel:function(){T(aN).dialog("close")}},width:320,height:200,draggable:false,resizable:false};T(aN).dialog(aM)});function aB(aL,aK){for(var aM=0;aM<aL.length;aM+=1){if(aL[aM].data("whatBtn")!==aK.data("whatBtn")){aL[aM].next().removeClass("ui-state-active");aL[aM].attr("checked",false)}}}function aG(){var aK=T(az).find(".intemasscanvas-canvas")[0];var aL=Q[T(az).attr("id")];T(aK).css("cursor","auto");aL.forEach(function(aM){aM.forEach(function(aN){if(aN.data("what")==="area"||aN.data("what")==="text"){aN.undrag();aN.hide()}else{if(aN.data("what")==="circle"){aN.undrag();aN.drag(y,M,B)}else{if(aN.data("what")==="path"){aN.undrag()}}}})})}function au(){var aK=T(az).find(".intemasscanvas-canvas")[0];var aL=Q[T(az).attr("id")];aL.forEach(function(aM){aM.forEach(function(aN){if(aN.data("what")=="area"){aN.hide()}})})}}function am(ar){var ap=T(ar).attr("id");var av=ap+"_intemass_menu";var at="";at+='<ul id="'+av+'" class="contextMenu">';at+='<li class="delete"><a href="#delete">Delete</a></li>';at+='<li class="about separator"><a href="#about">about</a></li>';at+="</ul>";T(at).appendTo(T(ar));var aq=T(ar).find(".intemasscanvas-canvas")[0];var au=Q[T(ar).attr("id")];T(aq).on("mousedown",function(az){var ay=this.offsetLeft;var aw=this.offsetTop-an;if(3==az.which){var ax=Q[T(ar).attr("id")];ax.forEach(function(aB){var aA=0;var aC=aB.getBBox();if(Raphael.isPointInsideBBox(aC,az.clientX-ay,az.clientY-aw)){aB.forEach(function(aD){if(aD.data("what")=="area"){if(aD.node.style.display!=""){aD.show();T(aq).one("mousedown",function(aE){aD.hide()})}aA=1;return false}})}if(aA==1){return false}})}});T(aq).contextMenu({menu:av},function(aA,aw,aE){if(aA==="delete"){var aD=T(ar).attr("id");var aG=Q[aD];aG.forEach(function(aH){if(aH.undo(aE.x,aE.y-an)===true){return false}})}if(aA==="about"){var aD=T(ar).attr("id");var aF="#"+aD+"-about-dialog";var ax={modal:true,buttons:{Ok:function(){T(aF).dialog("close")}},width:320,height:200,draggable:false,resizable:false};T(aF).dialog(ax)}if(aA==="edit"){var aD=T(ar).attr("id");var aG=Q[aD];aG.forEach(function(aI){var aJ=aI.getBBox();if(aJ&&Raphael.isPointInsideBBox(aJ,aE.x,aE.y)===true){var aH=T(ar).attr("id");var aL="#"+aH+"-legend-dialog";var aK={modal:true,buttons:{Done:function(){var aO=T("#"+aH+"-legend-input").val();var aP=aO+":"+aH;var aM=null;aI.forEach(function(aQ){if(aQ.data("what")=="text"){aM=aQ.attr("text")+":"+aH}});for(var aN in j){if(j[aN]==aP&&j[aN]!=aM){T("#"+aH+"-legend-dialog #dialogue_warning").css("color","red");return false}}j.push(aP);aI.forEach(function(aQ){if(aQ.data("what")=="text"){aQ.attr({text:aO})}});T(aL).dialog("close");T("#"+aH+"-legend-dialog #dialogue_warning").css("color","black")},Cancel:function(){T(aL).dialog("close")}},width:320,height:200,draggable:false,resizable:false};T(aL).dialog(aK);return false}})}if(aA==="cut"){var aG=Q[T(ar).attr("id")];aG.forEach(function(aI){var aH=false;aI.forEach(function(aJ){if(aJ.data("what")==="area"){r.bbox=aJ.getBBox()}if(aJ.data("what")==="path"){r.path=aJ.attr("path")}if(aJ.data("what")==="handler_path"){r.handler_path=aJ.attr("path")}if(aJ.data("what")==="text"){r.legend=aJ.attr("text")}if(aJ.data("what")==="dot"){aI.forEach(function(aK){if(aK.data("what")==="text"){r.legend=aK.attr("text")}});r.elset=aI.clone().remove();if(aI.undo(aE.x,aE.y-an)===true){}aH=true;return false}});if(r.bbox&&Raphael.isPointInsideBBox(r.bbox,aE.x,aE.y-an)===true){r.elset=aI.clone().remove();if(aI.undo(aE.x,aE.y-an)===true){}aH=true}if(aH===true){return false}})}if(aA==="copy"){var aG=Q[T(ar).attr("id")];aG.forEach(function(aI){var aH=false;aI.forEach(function(aJ){aJ.toFront();if(aJ.data("what")==="area"){r.bbox=aJ.getBBox()}if(aJ.data("what")==="path"){r.path=aJ.attr("path")}if(aJ.data("what")==="handler_path"){r.handler_path=aJ.attr("path")}if(aJ.data("what")=="dot"){r.elset=aI.clone().remove();aH=true}});if(r.bbox&&Raphael.isPointInsideBBox(r.bbox,aE.x,aE.y-an)===true){r.elset=aI.clone().remove();aH=true}if(aH===true){return false}})}if(aA==="paste"){var aD=T(ar).attr("id");var ay=W[aD];if(!r.elset){return false}var az={custom_path:r.path,custom_handler_path:r.handler_path,legend:r.legend,dashline:false,color:X[aD]};if(O(r.elset)==="line"){for(var aC=0;aC<r.path.length;aC++){for(var aB=1;aB<=2;aB++){if(aB%2===0){r.path[aC][aB]+=aE.y-r.bbox.y}else{r.path[aC][aB]+=aE.x-r.bbox.x}}}az.start_x=r.path[0][1];az.start_y=r.path[0][2];az.end_x=r.path[1][1];az.end_y=r.path[1][2];if(r.legend!=null){U(aD,az)}else{v(aD,U,az)}}if(O(r.elset)==="curve"){r.path[0][1]+=aE.x-r.bbox.x;r.path[1][1]+=aE.x-r.bbox.x;r.path[1][3]+=aE.x-r.bbox.x;r.path[1][5]+=aE.x-r.bbox.x;r.path[0][2]+=aE.y-r.bbox.y;r.path[1][2]+=aE.y-r.bbox.y;r.path[1][4]+=aE.y-r.bbox.y;r.path[1][6]+=aE.y-r.bbox.y;r.handler_path[0][1]+=aE.x-r.bbox.x;r.handler_path[0][2]+=aE.y-r.bbox.y;r.handler_path[1][1]+=aE.x-r.bbox.x;r.handler_path[1][2]+=aE.y-r.bbox.y;r.handler_path[2][1]+=aE.x-r.bbox.x;r.handler_path[2][2]+=aE.y-r.bbox.y;r.handler_path[3][1]+=aE.x-r.bbox.x;r.handler_path[3][2]+=aE.y-r.bbox.y;az.start_x=r.path[0][1];az.start_y=r.path[0][2];az.end_x=r.path[1][5];az.end_y=r.path[1][6];if(r.legend!==null){i(aD,az)}else{v(aD,i,az)}}if(O(r.elset)==="complexcurve"){for(var aC=0;aC<r.path.length;aC++){for(var aB=1;aB<r.path[aC].length;aB++){if(aB%2===0){r.path[aC][aB]+=aE.y-r.bbox.y}else{r.path[aC][aB]+=aE.x-r.bbox.x}}}for(var aC=0;aC<r.handler_path.length;aC++){for(var aB=1;aB<r.handler_path[aB].length;aB++){if(aB%2===0){r.handler_path[aC][aB]+=aE.y-r.bbox.y}else{r.handler_path[aC][aB]+=aE.x-r.bbox.x}}}az.start_x=r.path[0][1];az.start_y=r.path[0][2];az.end_x=r.path[3][5];az.end_y=r.path[3][6];if(r.legend!==null){J(aD,az)}else{v(aD,J,az)}}if(O(r.elset)==="dot"){if(r.legend!==null){f(aD,az)}else{az.start_x=aE.x;az.start_y=aE.y-an;az.end_x=null;az.end_y=null;v(aD,f,az)}}r={}}})}function v(ap,at,ar){var av="#"+ap+"-legend-dialog";var aq="L";var au={modal:true,buttons:{Done:function(){ar.color=X[ap];ar.dashline=(T("#"+ap+"-legend-dashline").attr("checked")==="checked");ar.horizontal=(T("#"+ap+"-legend-horizontal").attr("checked")==="checked");ar.vertical=(T("#"+ap+"-legend-vertical").attr("checked")==="checked");if(at===o){aq=T("#"+ap+"-tips-input").val()}else{aq=T("#"+ap+"-legend-input").val()}ar.legend=aq;var ax=aq+":"+ap;for(var aw=0;aw<j.length;aw+=1){if(j[aw]===ax){T("#"+ap+"-legend-dialog #dialogue_warning").css("color","red");return false}}j.push(ax);if(ar.horizontal||ar.vertical){ar.dashline=true;U(ap,ar)}else{at(ap,ar)}if(x!==null){x.next().removeClass("ui-state-active");x.attr("checked",false);x=null}T(av).dialog("close");T("#"+ap+"-legend-dialog #dialogue_warning").css("color","black")},Cancel:function(){if(x!==null){x.next().removeClass("ui-state-active");x.attr("checked",false);x=null}T(av).dialog("close")}},open:function(ax,aw){if(at===U){T(ax.target).parent().find("label").parent().append("<p><input id='"+ap+"-legend-dashline' type='checkbox'>dashline</input></p>")}else{if(at===f){T(ax.target).parent().find("label").parent().append("<form><input id='"+ap+"-legend-horizontal' type='checkbox'>horizontal</input><input id='"+ap+"-legend-vertical' type='checkbox'>vertical</input></form>")}}},close:function(ax,aw){T(ax.target).parent().find("#"+ap+"-legend-dashline").parent().remove();T(ax.target).parent().find("#"+ap+"-legend-horizontal").parent().remove()},width:320,height:230,draggable:false,resizable:false};if(at===o){av="#"+ap+"-tips-dialog";au.height=260}T(av).dialog(au)}function J(aE,ax){var ap=ax.legend;var aA=W[aE];var av={fill:"#000",stroke:"none"};var aB={fill:"#00CC00",stroke:"none"};var aM=ax.color;var aG=ax.start_x;var aD=ax.start_y;var aP=ax.end_x;var aN=ax.end_y;var aI=ax.custom_path;var au=ax.custom_handler_path;var aR=aG;var aQ=aD<(Y.height-30)?(aD+30):Y.height;var aK=aP;var aJ=aN<(Y.height-30)?(aN+30):Y.height;var aH=(aG+aP)/2;var aF=aD<(Y.height-210)?(aD+210):Y.height;var at=(aG+aP)/2>60?((aG+aP)/2-60):0;var ar=aD<(Y.height-210)?(aD+210):Y.height;var az=(aG+aP)/2<(Y.width-60)?((aG+aP)/2+60):Y.width;var ay=aD<(Y.height-210)?(aD+210):Y.height;var aq,aw;(function aL(){if(aI===null){aq=[["M",aG,aD],["C",aR,aQ,at,ar,aH,aF],["M",aH,aF],["C",az,ay,aK,aJ,aP,aN]]}else{aq=aI}}());(function aO(){if(au===null){aw=[["M",aG,aD],["L",aR,aQ],["M",aP,aN],["L",aK,aJ],["M",at,ar],["L",aH,aF],["M",az,ay],["L",aH,aF]]}else{aw=au;aR=au[1][1];aQ=au[1][2];aK=au[3][1];aJ=au[3][2];aH=au[5][1];aF=au[5][2];at=au[4][1];ar=au[4][2];az=au[6][1];ay=au[6][2]}}());m[aE]["drawopts"][ap]={type:"complexcurve",start_x:aG,start_y:aD,end_x:aP,end_y:aN,color:X[aE],custom_path:aq,custom_handler_path:aw,rcoordinate:aj(aq)};var aC=aA.set(aA.path(aq).attr({stroke:aM||Raphael.getColor(),"stroke-width":4,"stroke-linecap":"round"}).data("what","path"),aA.path(aw).attr({stroke:"#996600","stroke-dasharray":". "}).data("what","handler_path"),aA.circle(aG,aD,5).attr(av).data("what","circle"),aA.circle(aR,aQ,5).attr(aB).data("what","circle"),aA.circle(aK,aJ,5).attr(aB).data("what","circle"),aA.circle(aP,aN,5).attr(aB).data("what","circle"),aA.circle(aH,aF,5).attr(aB).data("what","circle"),aA.circle(at,ar,5).attr(aB).data("what","circle"),aA.circle(az,ay,5).attr(aB).data("what","circle"),aA.text(aq[3][5]+50,aq[3][6],ap).attr({"font-size":"15px"}).data("what","text").hide(),aA.rect(Raphael.pathBBox(aq).x,Raphael.pathBBox(aq).y,Raphael.pathBBox(aq).width,Raphael.pathBBox(aq).height).attr({fill:"#00CCCC","fill-opacity":0,stroke:"#996699","stroke-dasharray":". "}).data("what","area").hide());aC[0].update=function(aS,aT){aC[2].update(aS,aT)};aC[2].update=function(aS,aW){var aV=this.attr("cx")+aS;var aT=this.attr("cy")+aW;this.attr({cx:aV,cy:aT});aq[0][1]=aV;aq[0][2]=aT;aw[0][1]=aV;aw[0][2]=aT;aC[3].update(aS,aW);aC[5].update(aS,aW);aC[6].update(aS,aW);var aU=Raphael.pathBBox(aq);aC[10].attr({x:aU.x,y:aU.y,width:aU.width,height:aU.height});m[aE]["drawopts"][ap]["start_x"]=aV;m[aE]["drawopts"][ap]["start_y"]=aT;m[aE]["drawopts"][ap]["custom_path"]=aq;m[aE]["drawopts"][ap]["custom_handler_path"]=aw};aC[3].update=function(aS,aW){var aV=this.attr("cx")+aS;var aT=this.attr("cy")+aW;this.attr({cx:aV,cy:aT});aq[1][1]=aV;aq[1][2]=aT;aw[1][1]=aV;aw[1][2]=aT;aC[0].attr({path:aq});aC[1].attr({path:aw});var aU=Raphael.pathBBox(aq);aC[10].attr({x:aU.x,y:aU.y,width:aU.width,height:aU.height});m[aE]["drawopts"][ap]["custom_path"]=aq;m[aE]["drawopts"][ap]["custom_handler_path"]=aw};aC[4].update=function(aS,aW){var aV=this.attr("cx")+aS;var aT=this.attr("cy")+aW;this.attr({cx:aV,cy:aT});aq[3][3]=aV;aq[3][4]=aT;aw[3][1]=aV;aw[3][2]=aT;aC[0].attr({path:aq});aC[1].attr({path:aw});var aU=Raphael.pathBBox(aq);aC[10].attr({x:aU.x,y:aU.y,width:aU.width,height:aU.height});m[aE]["drawopts"][ap]["custom_path"]=aq;m[aE]["drawopts"][ap]["custom_handler_path"]=aw};aC[5].update=function(aS,aW){var aV=this.attr("cx")+aS;var aT=this.attr("cy")+aW;this.attr({cx:aV,cy:aT});aq[3][5]=aV;aq[3][6]=aT;aw[2][1]=aV;aw[2][2]=aT;aC[4].update(aS,aW);aC[9].attr({x:aV+50,y:aT});var aU=Raphael.pathBBox(aq);aC[10].attr({x:aU.x,y:aU.y,width:aU.width,height:aU.height});m[aE]["drawopts"][ap]["end_x"]=aV;m[aE]["drawopts"][ap]["end_y"]=aT;m[aE]["drawopts"][ap]["custom_path"]=aq;m[aE]["drawopts"][ap]["custom_handler_path"]=aw};aC[6].update=function(aS,aW){var aV=this.attr("cx")+aS;var aT=this.attr("cy")+aW;this.attr({cx:aV,cy:aT});aq[1][5]=aV;aq[1][6]=aT;aq[2][1]=aV;aq[2][2]=aT;aw[5][1]=aV;aw[5][2]=aT;aw[7][1]=aV;aw[7][2]=aT;aC[7].update(aS,aW);aC[8].update(aS,aW);var aU=Raphael.pathBBox(aq);aC[10].attr({x:aU.x,y:aU.y,width:aU.width,height:aU.height});m[aE]["drawopts"][ap]["custom_path"]=aq;m[aE]["drawopts"][ap]["custom_handler_path"]=aw};aC[7].update=function(aS,aW){var aV=this.attr("cx")+aS;var aT=this.attr("cy")+aW;this.attr({cx:aV,cy:aT});aq[1][3]=aV;aq[1][4]=aT;aw[4][1]=aV;aw[4][2]=aT;aC[0].attr({path:aq});aC[1].attr({path:aw});var aU=Raphael.pathBBox(aq);aC[10].attr({x:aU.x,y:aU.y,width:aU.width,height:aU.height});m[aE]["drawopts"][ap]["custom_path"]=aq;m[aE]["drawopts"][ap]["custom_handler_path"]=aw};aC[8].update=function(aS,aW){var aV=this.attr("cx")+aS;var aT=this.attr("cy")+aW;this.attr({cx:aV,cy:aT});aq[3][1]=aV;aq[3][2]=aT;aw[6][1]=aV;aw[6][2]=aT;aC[0].attr({path:aq});aC[1].attr({path:aw});var aU=Raphael.pathBBox(aq);aC[10].attr({x:aU.x,y:aU.y,width:aU.width,height:aU.height});m[aE]["drawopts"][ap]["custom_path"]=aq;m[aE]["drawopts"][ap]["custom_handler_path"]=aw};aC[10].update=function(aS,aU){aC[2].update(aS,aU);var aT=Raphael.pathBBox(aq);this.attr({x:aT.x,y:aT.y,width:aT.width,height:aT.height})};aC[2].drag(y,M,B);aC[3].drag(y,M,B);aC[4].drag(y,M,B);aC[5].drag(y,M,B);aC[6].drag(y,M,B);aC[7].drag(y,M,B);aC[8].drag(y,M,B);aC[10].drag(y,M,B);aC[2].update(0,0);Q[aE].push(aC)}function i(aB,aw){function aq(aL){var aM=aL.getBBox();aL.forEach(function(aN){if(aN.data("what")=="area"){aN.attr({x:aM.x,y:aM.y})}})}var ap=aw.legend;var ax=W[aB];var au={fill:"#000",stroke:"none"};var ay={fill:"#00CC00",stroke:"none"};var aG=aw.color;var aC=aw.start_x;var aA=aw.start_y;var aI=aw.end_x;var aH=aw.end_y;var aE=aw.custom_path;var at=aw.custom_handler_path;var aK=aC<(Y.width-20)?(aC+20):Y.widthd;var aJ=aA;var aF=aI>40?(aI-40):0;var aD=aH;var ar;var av;if(aE===null){ar=[["M",aC,aA],["C",aK,aJ,aF,aD,aI,aH]]}else{ar=aE}if(at===null){av=[["M",aC,aA],["L",aK,aJ],["M",aI,aH],["L",aF,aD]]}else{av=at;aK=at[1][1];aJ=at[1][2];aF=at[3][1];aD=at[3][2]}m[aB]["drawopts"][ap]={type:"curve",start_x:aC,start_y:aA,end_x:aI,end_y:aH,color:X[aB],custom_path:ar,custom_handler_path:av,rcoordinate:aj(ar)};var az=ax.set(ax.path(ar).attr({stroke:aG||Raphael.getColor(),"stroke-width":4,"stroke-linecap":"round"}).data("what","path"),ax.path(av).attr({stroke:"#996600","stroke-dasharray":". "}).data("what","handler_path"),ax.circle(aC,aA,5).attr(au).data("what","circle"),ax.circle(aK,aJ,5).attr(ay).data("what","circle"),ax.circle(aF,aD,5).attr(ay).data("what","circle"),ax.circle(aI,aH,5).attr(ay).data("what","circle"),ax.text(ar[1][5]+50,ar[1][6],ap).attr({"font-size":"15px"}).data("what","text").hide(),ax.rect(Raphael.pathBBox(ar).x,Raphael.pathBBox(ar).y,Raphael.pathBBox(ar).width,Raphael.pathBBox(ar).height).attr({fill:"#00CCCC","fill-opacity":0,stroke:"#996699","stroke-dasharray":". "}).data("what","area").hide());az[0].update=function(aL,aM){az[2].update(aL,aM)};az[2].update=function(aL,aP){var aO=this.attr("cx")+aL;var aM=this.attr("cy")+aP;this.attr({cx:aO,cy:aM});ar[0][1]=aO;ar[0][2]=aM;av[0][1]=aO;av[0][2]=aM;az[3].update(aL,aP);az[5].update(aL,aP);var aN=Raphael.pathBBox(ar);az[7].attr({x:aN.x,y:aN.y,width:aN.width,height:aN.height});m[aB]["drawopts"][ap]["start_x"]=aO;m[aB]["drawopts"][ap]["start_y"]=aM;m[aB]["drawopts"][ap]["custom_path"]=ar;m[aB]["drawopts"][ap]["custom_handler_path"]=av};az[3].update=function(aL,aP){var aO=this.attr("cx")+aL;var aM=this.attr("cy")+aP;this.attr({cx:aO,cy:aM});ar[1][1]=aO;ar[1][2]=aM;av[1][1]=aO;av[1][2]=aM;az[0].attr({path:ar});az[1].attr({path:av});var aN=Raphael.pathBBox(ar);az[7].attr({x:aN.x,y:aN.y,width:aN.width,height:aN.height});m[aB]["drawopts"][ap]["custom_path"]=ar;m[aB]["drawopts"][ap]["custom_handler_path"]=av};az[4].update=function(aL,aP){var aO=this.attr("cx")+aL;var aM=this.attr("cy")+aP;this.attr({cx:aO,cy:aM});ar[1][3]=aO;ar[1][4]=aM;av[3][1]=aO;av[3][2]=aM;az[0].attr({path:ar});az[1].attr({path:av});var aN=Raphael.pathBBox(ar);az[7].attr({x:aN.x,y:aN.y,width:aN.width,height:aN.height});m[aB]["drawopts"][ap]["custom_path"]=ar;m[aB]["drawopts"][ap]["custom_handler_path"]=av};az[5].update=function(aL,aP){var aO=this.attr("cx")+aL;var aM=this.attr("cy")+aP;this.attr({cx:aO,cy:aM});ar[1][5]=aO;ar[1][6]=aM;av[2][1]=aO;av[2][2]=aM;az[4].update(aL,aP);az[6].attr({x:aO+50,y:aM});var aN=Raphael.pathBBox(ar);az[7].attr({x:aN.x,y:aN.y,width:aN.width,height:aN.height});m[aB]["drawopts"][ap]["end_x"]=aO;m[aB]["drawopts"][ap]["end_y"]=aM;m[aB]["drawopts"][ap]["custom_path"]=ar;m[aB]["drawopts"][ap]["custom_handler_path"]=av};az[7].update=function(aL,aN){az[2].update(aL,aN);var aM=Raphael.pathBBox(ar);this.attr({x:aM.x,y:aM.y,width:aM.width,height:aM.height})};az[2].drag(y,M,B);az[3].drag(y,M,B);az[4].drag(y,M,B);az[5].drag(y,M,B);az[7].drag(y,M,B);az[2].update(0,0);Q[aB].push(az)}function U(ax,at){var az=at.legend;var ar=W[ax];var aw={fill:"#00CC00",stroke:"none"};var ap={fill:"#000",stroke:"none"};var aq={fill:"#993300",stroke:"none"};var av=at.color;var aB=at.start_x;var ay=at.start_y;var aD,aC,au;if(at.horizontal){aD=S.start_x;aC=at.start_y}else{if(at.vertical){aD=at.start_x;aC=S.start_y}else{aD=at.end_x;aC=at.end_y}}if(at.custom_path===null){au=[["M",aB,ay],["L",aD,aC]]}else{au=at.custom_path}m[ax]["drawopts"][az]={type:"line",color:X[ax],dashline:at.dashline,vertical:at.vertical,horizontal:at.horizontal,start_x:aB,start_y:ay,end_x:aD,end_y:aC,custom_path:null,custom_handler_path:null,rcoordinate:aj(au)};var aA=ar.set();if(at.dashline){aA.push(ar.path().attr({path:au,stroke:av||Raphael.getColor(),fill:"#00CCCC","fill-opacity":0,stroke:"#996699","stroke-dasharray":". "}).data("what","path"))}else{aA.push(ar.path().attr({path:au,stroke:av||Raphael.getColor(),"stroke-width":4,"stroke-linecap":"round"}).data("what","path"))}if(at.horizontal){m[ax]["drawopts"][az].type="axis-dashline";aA.push(ar.circle(aB,ay,5).attr(aq).data("what","dot"),ar.circle(aD,aC,5).attr(aq).data("what","horizontal"),ar.text(au[1][1]+50,au[1][2]-10,az).attr({"font-size":"15px"}).data("what","text"))}else{if(at.vertical){m[ax]["drawopts"][az].type="axis-dashline";aA.push(ar.circle(aB,ay,5).attr(aq).data("what","dot"),ar.circle(aD,aC,5).attr(aq).data("what","vertical"),ar.text(au[1][1]+50,au[1][2]-10,az).attr({"font-size":"15px"}).data("what","text"))}else{aA.push(ar.circle(aB,ay,5).attr(ap).data("what","circle"),ar.circle(aD,aC,5).attr(aw).data("what","circle"),ar.text(au[1][1]+50,au[1][2]-10,az).attr({"font-size":"15px"}).data("what","text").hide())}}aA.push(ar.rect(Raphael.pathBBox(au).x,Raphael.pathBBox(au).y,Raphael.pathBBox(au).width,Raphael.pathBBox(au).height).attr({fill:"#00CCCC","fill-opacity":0,stroke:"#996699","stroke-dasharray":". "}).data("what","area").hide());aA[0].update=function(aE,aF){aA[1].update(aE,aF)};aA[1].update=function(aE,aI){var aH=this.attr("cx")+aE;var aF=this.attr("cy")+aI;this.attr({cx:aH,cy:aF});au[0][1]=aH;au[0][2]=aF;aA[2].update(aE,aI);var aG=Raphael.pathBBox(au);aA[4].attr({x:aG.x,y:aG.y,width:aG.width,height:aG.height});m[ax]["drawopts"][az]["start_x"]=aH;m[ax]["drawopts"][az]["start_y"]=aF};aA[2].update=function(aE,aI){var aH,aF;if(at.horizontal){aH=this.attr("cx");aF=this.attr("cy")+aI}else{if(at.vertical){aH=this.attr("cx")+aE;aF=this.attr("cy")}else{aH=this.attr("cx")+aE;aF=this.attr("cy")+aI}}this.attr({cx:aH,cy:aF});au[1][1]=aH;au[1][2]=aF;aA[0].attr({path:au});aA[3].attr({x:aH+50,y:aF-10});var aG=Raphael.pathBBox(au);aA[4].attr({x:aG.x,y:aG.y,width:aG.width,height:aG.height});m[ax]["drawopts"][az]["end_x"]=aH;m[ax]["drawopts"][az]["end_y"]=aF};aA[4].update=function(aE,aG){aA[1].update(aE,aG);var aF=Raphael.pathBBox(au);this.attr({x:aF.x,y:aF.y,width:aF.width,height:aF.height})};aA[1].drag(y,M,B);if(!at.horizontal&&!at.vertical){aA[2].drag(y,M,B)}aA[4].drag(y,M,B);aA[1].update(0,0);Q[ax].push(aA)}function f(at,ar){var au=ar.legend;var aq=W[at];var ap={fill:"#993300",stroke:"none"};var ax=ar.start_x;var av=ar.start_y;var az=ar.end_x;var ay=ar.end_y;m[at]["drawopts"][au]={type:"dot",start_x:ax,start_y:av,end_x:null,end_y:null,color:X[at],custom_path:null,custom_handler_path:null,rcoordinate:null};var aw=aq.set(aq.circle(ax,av,6).attr(ap).data("what","dot"),aq.text(ax+50,av+15,au).attr({"font-size":"15px"}).data("what","dottext"));aw[0].update=function(aA,aD){var aC=this.attr("cx")+aA;var aB=this.attr("cy")+aD;this.attr({cx:aC,cy:aB});aw[1].attr({x:aC+50,y:aB+15});this.toFront();m[at]["drawopts"][au]["start_x"]=aC;m[at]["drawopts"][au]["start_y"]=aB;aw[1].toFront()};aw[0].drag(y,M,B);Q[at].push(aw)}function o(at,aq){var au=aq.legend;var ap=W[at];var ax=aq.start_x;var av=aq.start_y;var az=aq.end_x;var ay=aq.end_y;m[at]["drawopts"][au]={type:"tips",start_x:ax,start_y:av,end_x:null,end_y:null,color:X[at],custom_path:null,custom_handler_path:null,rcoordinate:null};var aw=ap.set();aw.push(ap.text(ax,av,au).attr({"font-size":"15px"}).data("what","tipstext"));var ar=aw[0].getBBox();aw.push(ap.rect(ar.x,ar.y,ar.width,ar.height).attr({fill:"#00CCCC","fill-opacity":0,stroke:"#996699","stroke-dasharray":". "}).data("what","area").hide());aw[0].update=function(aA,aD){var aC=this.attr("x")+aA;var aB=this.attr("y")+aD;this.attr({x:aC,y:aB});m[at]["drawopts"][au]["start_x"]=aC;m[at]["drawopts"][au]["start_y"]=aB};aw[1].update=function(aA,aD){var aC=this.attr("x")+aA;var aB=this.attr("y")+aD;this.attr({x:aC,y:aB});aw[0].update(aA,aD)};aw[1].drag(y,M,B);Q[at].push(aw)}function y(ar,aq){if(this.data("what")=="area"){this.attr({stroke:"#0000FF","stroke-dasharray":"--."})}ag+=1;if(ag%5!=0){return false}var au=this.getBBox();var at=Y.width;var ap=Y.height;if(au.x>=0&&au.y>=0&&au.x2<=at&&au.y2<=ap){this.update(ar-(this.dx||0),aq-(this.dy||0));this.dx=ar;this.dy=aq}}function M(){var aq=null;if(this.data("what")==="dot"||this.data("what")==="circle"){function ap(ar){ar.animate({fill:"#993300",r:6},1000,"bounce")}if(this.data("what")==="dot"){aq=Raphael.animation({fill:"#FF9933",r:9},1000,"elastic",function(){})}else{aq=Raphael.animation({r:9},1000,"elastic",function(){})}this.animate(aq)}if(this.data("what")==="area"){this.attr({stroke:"#0000FF","stroke-dasharray":"--."})}this.dx=this.dy=0}function B(){var at=null;if(this.data("what")==="dot"||this.data("what")==="circle"){if(this.data("what")==="dot"){at=Raphael.animation({r:6,fill:"#993300"},1000,"bounce",function(){});var av=this.paper;var ax=[];av.forEach(function(aI){if(aI.data("what")=="path"){ax.push(aI)}});console.log(ax);var aH=null;var aG=null;var aw=25;var au=25;for(var aF=0;aF<ax.length;aF+=1){for(var aE=aF+1;aE<ax.length;aE+=1){var aD=Raphael.pathIntersection(ax[aF].attr("path"),ax[aE].attr("path"));for(var aC=0;aC<aD.length;aC+=1){var aB=aD[aC].x;var aA=aD[aC].y;var aq=Math.abs(aB-this.attr("cx"));var ap=Math.abs(aA-this.attr("cy"));if(aq<=25&&ap<=25){if(aq<=aw&&ap<=au){ax[aF].toBack();ax[aE].toBack();aw=aq;au=ap;aH=aB;aG=aA}}}}}if(aH!==null&&aG!==null){this.attr({cx:aH,cy:aG});if(this.next.data("what")==="horizontal"){this.next.attr({cy:aG})}else{if(this.next.data("what")==="vertical"){this.next.attr({cx:aH})}}}}else{at=Raphael.animation({r:5},1000,"bounce",function(){})}this.animate(at)}if(this.data("what")==="area"){this.attr({stroke:"#996699","stroke-dasharray":". "})}var az=Y.width;var ay=Y.height;var ar=this.getBBox();var aH=0;var aG=0;if(ar.x<=0){aH=-ar.x+3}if(ar.y<=0){aG=-ar.y+3}if(ar.x2>=az){aH=az-ar.x2-3}if(ar.y2>=ay){aG=ay-ar.y2-3}this.update(aH,aG)}function al(ax,av){if(av.direction==="0"&&q[ax][0]){delete m[ax]["axis"]["x"];q[ax][0].remove();delete q[ax][0]}if(av.direction==="1"&&q[ax][1]){delete m[ax]["axis"]["y"];q[ax][1].remove();delete q[ax][1]}var au=W[ax];var aw=undefined;var ar=av.name+"("+av.unit+")";var aD=S.start_x;var aC=S.start_y;var aq=16;var aA=3;var ay=1;var aB=0;var ap=au.set();var az;var at;if(av.direction==="0"){m[ax]["axis"]["x"]=av;var aF=Y.width-60;at=Math.round((aF-aD-av.splits-aq)/av.splits);aw=[["M",aD,aC]];ap.push(au.text(aD,aC+10,av.start));for(aB=0;aB<av.splits;aB+=1){aw=aw.concat([["l",at,0]],[["v",-aA]],[["h",ay]],[["v",aA]]);az=Number(av.start)+((av.end-av.start)/av.splits)*(aB+1);ap.push(au.text(aD+(aB+1)*at,aC+10,az.toFixed(2)))}aw=aw.concat([["l",aq,0]],[["v",-(2*aA)]],[["l",aq/2,2*aA]],[["l",-(aq/2),2*aA]],[["v",-(2*aA)]]);ap.push(au.text((aF-aD)/2+20,aC+25,ar).attr({"font-size":16}));ap.push(au.path(aw).data("what","path").attr({fill:"#000",stroke:"#000"}));q[ax][0]=ap}else{m[ax]["axis"]["y"]=av;var aE=50;at=Math.round((aC-aE-av.splits-aq)/av.splits);aw=[["M",aD,aC]];ap.push(au.text(aD-15,aC-4,av.start));for(aB=0;aB<av.splits;aB+=1){aw=aw.concat([["l",0,-at]],[["h",aA]],[["v",-ay]],[["h",-aA]]);az=Number(av.start)+((av.end-av.start)/av.splits)*(aB+1);ap.push(au.text(aD-15,aC-(aB+1)*at-4,az.toFixed(2)))}aw=aw.concat([["v",-(aq)]],[["h",2*aA]],[["l",-(2*aA),-(aq/2)]],[["l",-(2*aA),aq/2]],[["h",2*aA]]);ap.push(au.text(aD-40,(aC-aE)/2+10,ar).attr({"font-size":16}));ap.push(au.path(aw).data("what","path").attr({fill:"#000",stroke:"#000"}));q[ax][1]=ap}}function H(az,aq,ax,ap,aw){var au=T(az).attr("id");var ar=W[au];var aA,ay,at,av;if(aq<ap){aA=aq;at=ap-aq}else{aA=ap;at=aq-ap}if(ax<aw){ay=ax;av=aw-ax}else{ay=aw;av=ax-aw}if(aa){aa.attr({x:aA,y:ay,width:at,height:av})}else{aa=ar.rect(aA,ay,at,av).attr({fill:"#aaa",stroke:"#eee",opacity:0.3})}}function L(aq){var ar=aq[0];var ap=aq[1];var au,at;if(aq[2]<=aq[0]){ar=aq[2];au=aq[0]}else{au=aq[2]}if(aq[3]<=aq[1]){ap=aq[3];at=aq[1]}else{at=aq[3]}return{x:ar,y:ap,x2:au,y2:at}}function d(at,ar){var aq=L(ar);var ap,au;if(at.hasOwnProperty("x")){ap=at.x;au=at.y}else{ap=at.attr("cx");au=at.attr("cy")}if(ap>=aq.x&&ap<=aq.x2&&au>=aq.y&&au<=aq.y2){return true}else{return false}}function ak(ap,at){if(at.length===0){return true}var au=ap.attr("path");var ar=Raphael.pathBBox(au);var aq=L(at);if((ar.x>aq.x&&ar.x<aq.x2&&ar.y>aq.y&&ar.y<aq.y2)&&(ar.x2>aq.x&&ar.x2<aq.x2&&ar.y2>aq.y&&ar.y2<aq.y2)){return true}else{return false}}function P(aw,av,au,aq){var ax=av.elem;var az=au.elem;var at=ax[ax.length-1]["location"];var ay=az[az.length-1]["location"];if(aq.length===0){var ar=Raphael.pathBBox(at);aq=[ar.x,ar.y,ar.x2,ar.y2]}var ap=Raphael.pathIntersection(at,ay);if(ap.length>0){return ap}return false}function c(at,ar,au){var ax=au.x,av=au.y,ap=au.x2,aw=au.y2;var aq=au.width,ay=au.height;return[(at-ax)/aq,(ar-av)/ay]}function ae(ap){if(ap.length===4){return"complexcurve"}else{if(ap[1][0]==="L"){return"line"}else{if(ap[1][0]==="C"){return"curve"}}}}function aj(aq){var ap=Raphael.pathBBox(aq);if(ae(aq)==="complexcurve"){return[c(aq[0][1],aq[0][2],ap),c(aq[1][1],aq[1][2],ap),c(aq[3][3],aq[3][4],ap),c(aq[3][5],aq[3][6],ap),c(aq[2][1],aq[2][2],ap),c(aq[1][5],aq[1][6],ap),c(aq[3][1],aq[3][2],ap)]}else{if(ae(aq)==="curve"){return[c(aq[1][1],aq[1][2],ap),c(aq[1][3],aq[1][4],ap),c(aq[0][1],aq[0][2],ap),c(aq[1][5],aq[1][6],ap)]}else{if(ae(aq)==="line"){return[[0,0],[1,1]]}}}}function C(ar){var ap=ar.elem;var aq=ap[ap.length-1]["location"];return Raphael.pathBBox(aq)}function ac(ap,ar,aq){if(P(ap,ar,aq,[])){return"Intersect"}else{var au=C(ar);var at=C(aq);if((au.y+au.height/2)>(at.y+at.height/2)&&((au.x+au.width/2)<(at.x+at.width/2))){return"Below"}else{if((au.y+au.height/2)<(at.y+at.height/2)&&((au.x+au.width/2)>(at.x+at.width/2))){return"Above"}else{return"Undefined"}}}return rule}function l(ap,ar,aq){if(P(ap,ar,aq,[])){return"Intersect"}else{var au=C(ar);var at=C(aq);if((au.y+au.height/2)>(at.y+at.height/2)&&((au.x+au.width/2)<(at.x+at.width/2))){return"Below"}else{if((au.y+au.height/2)<(at.y+at.height/2)&&((au.x+au.width/2)>(at.x+at.width/2))){return"Above"}else{return"Undefined"}}}return rule}function R(ap,ar,aq){if(P(ap,ar,aq,[])){return"Intersect"}else{var au=C(ar);var at=C(aq);if((au.y+au.height/2)>(at.y+at.height/2)&&((au.x+au.width/2)<(at.x+at.width/2))){return"Below"}else{if((au.y+au.height/2)<(at.y+at.height/2)&&((au.x+au.width/2)>(at.x+at.width/2))){return"Above"}else{return"Undefined"}}}}function ad(ar,aq,ap){var at=[];if(ar==="Undefined"){at.push([aq.legend+"("+aq.type+") ","Above ",ap.legend+"("+ap.type+") "]);at.push([aq.legend+"("+aq.type+") ","Below ",ap.legend+"("+ap.type+") "])}else{at.push([aq.legend+"("+aq.type+") ",ar+" ",ap.legend+"("+ap.type+") "])}return at}function p(ap,ar,aq){var at=[];if(ar.type==="complexcurve"&&aq.type==="complexcurve"){relation=ac(ap,ar,aq);at=ad(relation,ar,aq)}else{if(ar.type!=="complexcurve"&&aq.type!=="complexcurve"){relation=l(ap,ar,aq);at=ad(relation,ar,aq)}else{if(ar.type!=="complexcurve"&&aq.type==="complexcurve"){relation=R(ap,ar,aq);at=ad(relation,ar,aq)}else{relation=R(ap,aq,ar);at=ad(relation,aq,ar)}}}return at}function A(ar,aq){var ap=[];if(Math.abs(ar.location[0]-aq.location[0])<8&&Math.abs(ar.location[1]-aq.location[1])<8){ap.push("Coincide")}else{if(Math.abs(ar.location[0]-aq.location[0])>8){if(ar.location[0]<aq.location[0]){ap.push("Left")}else{if(ar.location[0]>aq.location[0]){ap.push("Right")}}}if(Math.abs(ar.location[1]-aq.location[1])>8){if(ar.location[1]<aq.location[1]){ap.push("Above")}else{if(ar.location[1]>aq.location[1]){ap.push("Below")}}}}return ap}function z(ap,av,at){var aw=[];var au;for(var ar=0;ar<av.elem.length-1;ar+=1){for(var aq=0;aq<at.elem.length-1;aq+=1){au=[av.legend+"("+av.type+")["+av.elem[ar]["name"]+"] ",A(av.elem[ar],at.elem[aq])+" ",at.legend+"("+at.type+")["+av.elem[ar]["name"]+"] "];aw.push(au)}}return aw}function ab(ap,av){var at=av.elem.length-1;var au=av.elem[at]["location"];var ar=ap.elem[0]["location"][0];var aq=ap.elem[0]["location"][1];var aw=av.legend;if(Raphael.isPointInsidePath(au,ar,aq)||ao(aw,ar,aq)){return true}else{return false}}function ao(ax,av,at){for(var au=0;au<af.length;au+=1){var aw=af[au];for(var ar=0;ar<aw.length;ar+=1){if(ax===aw[ar][0]||ax===aw[ar][1]){var ap=aw[ar][2];if(ap.length>0){for(var aq=0;aq<ap.length;aq+=1){if(Math.abs(av-ap[aq]["x"])<8&&Math.abs(at-ap[aq]["y"])<8){return true}}}else{if(ap){if(Math.abs(av-ap.x)<8&&Math.abs(at-ap.y)<8){return true}}}}}}return false}function N(ax,av,at,aq){var ay=[];var ap,ar;if(av.type==="dot"&&at.type==="dot"){ay.push([av.legend+"("+av.type+") ",A(av.elem[0],at.elem[0])+" ",at.legend+"("+at.type+") "]);return ay}else{if(av.type==="dot"){ap=av;ar=at}else{ap=at;ar=av}}if(ab(ap,ar)){ay.push([ap.legend+"("+ap.type+") ","On ",ar.legend+"("+ar.type+") "])}else{for(var aw=0,au=ar.elem.length-1;aw<au;aw+=1){ay.push([ap.legend+"("+ap.type+") ",A(ap.elem[0],ar.elem[aw])+" ",ar.legend+"("+ar.type+")["+ar.elem[aw]["name"]+"] "])}}return ay}function n(au){var at=[];var ap;if(au.type==="dot"){ap=au.elem[0];if(I(ap)){at.push(au.legend+"("+au.type+") ","On ",I(ap)+" ")}}else{for(var ar=0,aq=au.elem.length-1;ar<aq;ar+=1){ap=au.elem[ar];if(I(ap)){at.push(au.legend+"("+au.type+")["+ap.name+"] ","On ",I(ap)+" ")}}}return at}function I(ap){if(ap.location[0]===S.start_x&&ap.location[1]===S.start_y){return"coordinate origin"}else{if(ap.location[0]===S.start_x){return"y-axis"}else{if(ap.location[1]===S.start_y){return"x-axis"}else{return}}}}function h(at,ar){var ap;var aq=u(at);ap={type:"complexcurve",legend:aq,elem:[]};if(d(at[2],ar)){ap.elem.push({name:"Start",location:[at[2].attr("cx"),at[2].attr("cy")]})}if(d(at[5],ar)){ap.elem.push({name:"End",location:[at[5].attr("cx"),at[5].attr("cy")]})}if(d(at[6],ar)){ap.elem.push({name:"Middle",location:[at[6].attr("cx"),at[6].attr("cy")]})}ap.elem.push({name:"Path",location:at[0].attr("path")});if(ak(at[0],ar)){ap.complete=true}else{ap.complete=false}return ap}function G(at,ar){var ap;var aq=u(at);ap={type:"curve",legend:aq,elem:[]};if(d(at[2],ar)){ap.elem.push({name:"Start",location:[at[2].attr("cx"),at[2].attr("cy")]})}if(d(at[5],ar)){ap.elem.push({name:"End",location:[at[5].attr("cx"),at[5].attr("cy")]})}ap.elem.push({name:"Path",location:at[0].attr("path")});if(ak(at[0],ar)){ap.complete=true}else{ap.complete=false}return ap}function g(at,ar){var ap;var aq=u(at);ap={type:"line",legend:aq,elem:[]};if(d(at[1],ar)){ap.elem.push({name:"Start",location:[at[1].attr("cx"),at[1].attr("cy")]})}if(d(at[2],ar)){ap.elem.push({name:"End",location:[at[2].attr("cx"),at[2].attr("cy")]})}ap.elem.push({name:"Path",location:at[0].attr("path")});if(ak(at[0],ar)){ap.complete=true}else{ap.complete=false}return ap}function k(au,at){var ar,aq=[];var ap=u(au);if(d(au[0],at)){aq.push({name:"Dot",location:[au[0].attr("cx"),au[0].attr("cy")]});ar={type:"dot",legend:ap,elem:aq,complete:false}}return ar}function a(aq,ap){switch(O(aq)){case"complexcurve":return h(aq,ap);break;case"curve":return G(aq,ap);break;case"line":return g(aq,ap);break;case"line":return g(aq,ap);break;case"dot":return k(aq,ap);break;default:return}}function e(ap,aw,av){for(var at=0;at<aw.length;at++){var ar=[];for(var aq=0;aq<at;aq++){var au=P(ap,aw[at],aw[aq],av);if(au){ar.push([aw[at]["legend"],aw[aq]["legend"],au])}}if(ar.length>0){af.push(ar)}}return af}function ah(at,ar,aA,ap,ay){var aq=[ar,aA,ap,ay];var aB=Q[at];var au=[];var aD=[];aB.forEach(function(aF){var aE=a(aF,aq);if(aE){au.push(aE)}});af=e(at,au,aq);for(var aw=0;aw<au.length;aw++){for(var av=0;av<aw;av++){var aC=[];if(au[aw]["complete"]===true&&au[av]["complete"]===true){if(au[aw]["legend"]<au[av]["legend"]){aC=p(at,au[aw],au[av])}else{aC=p(at,au[av],au[aw])}}else{if(au[aw]["type"]!=="dot"&&au[av]["type"]!=="dot"){if(au[aw]["legend"]<au[av]["legend"]){aC=z(at,au[aw],au[av])}else{aC=z(at,au[av],au[aw])}}else{if(au[aw]["type"]==="dot"||au[av]["type"]==="dot"){aC=N(at,au[aw],au[av],aq)}}}for(var az=0;az<aC.length;az+=1){aD.push(aC[az])}}var ax=n(au[aw]);if(ax.length>0){aD.push(ax)}}return aD}function w(at,ar){if(!V(ar)){var aq="#list"+at;T(aq).css("display","table-cell");T(aq+" thead tr").remove();T(aq+" thead a").remove();T(aq+" thead").append("<tr><th class='intemasscanvas-table'> Curve(Type)[Point]  </th><th class='intemasscanvas-table'> Relation  </th><th class='intemasscanvas-table'> Curve(Type)[Point]</th></tr>");T(aq+" tbody tr").remove();for(var au=0;au<ar.length;au+=1){for(var ap=0;ap<3;ap+=1){ar[au][ap]=ar[au][ap].replace(" ","")}T(aq+" tbody").append("<tr><td>"+ar[au][0]+"</td><td>"+ar[au][1]+"</td><td>"+ar[au][2]+"</td></tr>")}m[at]["rulelist"]=ar}}function s(ap,aq){T.post("/canvas/get/",{questionid:"1",csrfmiddlewaretoken:aq},function(aB){if(aB.state==="success"){var au,ay,at;m=aB.canvasmap;for(var aA in m){if(aA===ap){at=m[aA];for(var aD in at.axis){axis=at.axis[aD];al(aA,axis)}var az=[];for(var aC in at.drawopts){j.push(aC+":"+aA);var av=at.drawopts[aC];av.legend=aC;az.push(av)}var ax=function(aF,aE){if(aF.type==="dot"){return true}if(aF.type==="axis-dashline"){return true}};console.log(az.sort(ax));az=az.sort(ax);for(var aw in az){console.log(az[aw]);var av=az[aw];var ay=av.type;switch(ay){case"dot":f(aA,av);break;case"line":U(aA,av);break;case"axis-dashline":U(aA,av);break;case"curve":i(aA,av);break;case"complexcurve":J(aA,av);break;case"tips":o(aA,av);break;default:break}}w(aA,at.rulelist)}var ar=T("#"+ap+"-viewBtn");ar.trigger("click");ar.next().addClass("ui-state-active");ar.attr("checked",true)}}},"json")}function V(aq){for(var ap in aq){if(aq.hasOwnProperty(ap)){return false}}return true}function F(){for(var ap in m){if(!V(m[ap]["drawopts"])&&V(m[ap]["rulelist"])){rulelist=ah(ap,0,0,Y.width,Y.height);m[ap]["rulelist"]=rulelist}}}function Z(aq){F();var ap=T.toJSON(m);T.post("/canvas/upload/",{questionid:"1",canvasmap:ap,csrfmiddlewaretoken:aq},function(ar){if(ar.state==="success"){alert("upload success")}},"json")}})(jQuery);